# 9/2（日）

## Swiftのジェネリクスはどうやって動いているのかコンパイラのソースから探る

 - swiftは静的型付けなのになんでジェネリクスが動くの
   - 実行時に型が決まる
   - サイズの違う型でもok
 - 言語実装仕様を学ぶと
   - 言語選択の判断材料になったり
   - 早いコードが書けるようになる
 - コンパイラの動き
   - Swift - SIL - LLVM-IR - ネイティブ 
 - 中間生成言語を読む
   - SILのジェネリクスで実現されている
   - SILはswiftの型システムを持つ
   - LLVM-IR
     - X型の値はポインタ渡し、型のメタ情報を引数で渡しているなどの予想は立つ
 - コンパイラのソースコードを読む
   - 型パラメータは型の情報を渡す引数になる
 - Swiftにおけるコピーは値型と参照型の操作は違う
     - 参照型=retain count操作
     - 値型=stored propertyごとに再帰的に操作
 - 型情報にはValue Witness Tableが入っているので調べる
 - TypeInfoのサブクラス
 - Decksetが落ちた
 
 ## デバイス・OSバージョンの依存が少なく、メンテナンスしやすいビューを作る

 - レイアウトはなぜ壊れるのか
   - Tabバーが下にめり込む
   - オーバーレイのViewのサイズがおかしい
   - スクロールバーがViewの端を突き抜ける
 - リリース前に特定状況でしか起きないレイアウト崩れに気づくのは難しい
   - 見つける仕組みが必要
   - クラッシュするわけではない
   - 正しさの定義が難しい
 - 問題は何か
   - Viewは状態が多い、ダイナミックに変化する、実行するまでわからない
   - 状態を減らし、静的に定義し、実行せずに確認したい
 - アンチパターン
   - デバイスを判定する
     - 条件を増やしてはいけない
     - 継続可能な仕組みではない
   - 標準UIのサイズを仮定する
 - SafeAreaにつけるかどうか
 - FrameLayoutよりもAutoLayout

## iOS アプリの開発速度を70%高速化したデバッグノウハウ

 - LLDBを使いこなす
   - コールスタックを遡る
   - リビルドなしで再実行する
   - 起動したまま状態を変更する
     - swiftのスタックフレームじゃない場合はエラーが出る
     - lldbで変数宣言するときは$を先頭につける（let $label = ~）
 - 実装直後にデバッグする、このループをなるべく短くする
 - 不安駆動でセルフチェックする
   - 手戻りが多いと人数でスケールしないので開発速度が落ちる
   - あとで見つかるよりは先にセルフチェックで見つけたい
   - でも動作確認担当のひとと分業できてない
   - 不安と実際の経験が結びつくように不安の精度をアップデートする
 - 動作確認を自動化する
   - 影響するコンポーネントの動作確認は時間がかるし、動作確認の仕方を覚えてない！
   - こういうものは自動化しよう
   - AppDelegate経由で動作確認する
     - 詳しくはスライドであとで見てね
     - https://speakerdeck.com/orgachem/debugging-knowhow-that-improved-our-development-velocity-to-170-percent
   - XCTestで動作確認（標準ライブラリがおすすめ）
 - 改善前との比較
 - 自動化の谷問題
   - なんかいろいろ知識が必要で大変！
   - 自動化で楽になるまでの辛い時期 = 自動化の谷
   - コードの年齢は若い方が谷は超えやすい
   - 練習アプリ（https://github.com/Kuniwak/TestableDesignExample）
 - discordの#testingで質問もできる
 - PEAKSでテスト本を出す予定
